<!--
 * @Description: 
 * @Version: 1.0
 * @Author: Li Yuanhao
 * @Email: dalao_li@163.com
 * @Date: 2021-02-11 21:50:35
 * @LastEditors: Li Yuanhao
 * @LastEditTime: 2021-02-16 23:49:28
-->
## 内存分配方式

### 静态存储区域分配

由**编译器自动分配和释放**,在程序编译的时已分配好,在程序整个运行期间都存在,直到整个程序运行结束时才被释放,如**全局变量**与 **static 变量**.

### 栈上分配

由**编译器自动分配和释放**,在执行函数时函数内局部变量的存储单元都可以在栈上创建,函数执行结束时这些存储单元将被自动释放.注意,栈内存分配运算内置于处理器的指令集中,其运行效率一般很高,但是分配的内存容量有限

### 堆上分配(动态内存分配)

由程序员**手动完成申请和释放**.运行时使用内存分配函数(如 malloc 函数)来申请任意内存,使用完后再使用内存释放函数(如 free 函数)来释放内存.动态内存的整个生存期由程序员决定,使用非常灵活.如果在堆上分配了内存空间,就必须及时释放,否则将会导致运行的程序出现内存泄漏等错误.

## 内存分配中的堆和栈

```c
#include <stdio.h>
#include <malloc.h>
int main(void){
    //在栈上分配
    int i1=0;
    int i2=0;
    int i3=0;
    printf("栈:向下\n");
    printf("i1=%x\n",&i1);
    printf("i2=%x\n",&i2);
    printf("i3=%x\n",&i3);
     
    //在堆上分配
    printf("\n堆:向上\n");
    char *p1 = (char *)malloc(4);
    char *p2 = (char *)malloc(4);
    char *p3 = (char *)malloc(4);
    printf("p1=%x\n",p1);
    printf("p2=%x\n",p2);
    printf("p3=%x\n",p3);
    
    //释放堆内存
    free(p1);
    p1=NULL;
    free(p2);
    p2=NULL;
    free(p3);
    p3=NULL;
    return 0;
}
```


![](https://cdn.hurra.ltd/img/20210212164733.png)



从运行结果可发现:
- 内存中栈区主要用于分配局部变量空间,处于相对较高的地址,**栈地址向下增长**
- 内存中堆区则主要用于分配程序员申请的内存空间,**堆地址向上增长**



## C 语言中各类型变量的存储位置和作用域.
- 全局变量.从静态存储区域分配,其作用域是全局作用域,也就是整个程序的生命周期内都可以使用.与此同时,如果程序是由多个源文件构成的,那么全局变量只要在一个文件中定义,就可以在其他所有的文件中使用,但必须在其他文件中通过使用extern关键字来声明该全局变量.
- 全局静态变量.从静态存储区域分配,其生命周期也是与整个程序同在的,从程序开始到结束一直起作用.但是与全局变量不同的是,全局静态变量作用域只在定义它的一个源文件内,其他源文件不能使用.
- 局部变量.从栈上分配,其作用域只是在局部函数内,在定义该变量的函数内,只要出了该函数,该局部变量就不再起作用,该变量的生命周期也只是和该函数同在.
- 局部静态变量.从静态存储区域分配,其在第一次初始化后就一直存在直到程序结束,该变量的特点是其作用域只在定义它的函数内可见,出了该函数就不可见了.